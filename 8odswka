local Library = {}
Library.__index = Library

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")

-- Helper function to create a new instance
local function createInstance(className, properties)
    local instance = Instance.new(className)
    for prop, value in pairs(properties) do
        instance[prop] = value
    end
    return instance
end

-- Initialize UI
function Library:Init(title)
    local screenGui = Instance.new("ScreenGui")
    screenGui.Parent = RunService:IsStudio() and Players.LocalPlayer:WaitForChild("PlayerGui") or CoreGui

    self.Window = createInstance("Frame", {
        Size = UDim2.new(0, 200, 0, 160),
        BackgroundColor3 = Color3.fromRGB(40, 40, 40),
        Position = UDim2.new(0, 200, 0, 100),
        BorderSizePixel = 0,
        Parent = screenGui
    })
    
    local titleLabel = createInstance("TextLabel", {
        Size = UDim2.new(1, 0, 0, 50),
        BackgroundColor3 = Color3.fromRGB(0, 122, 204),
        TextColor3 = Color3.fromRGB(255, 255, 255),
        Text = title,
        TextScaled = true,
        BorderSizePixel = 0,
        Parent = self.Window
    })
    
    self.Sections = {}
end

-- Create a new Section
function Library:CreateSection(title)
    local section = createInstance("Frame", {
        Size = UDim2.new(1, 0, 0, 100),
        BackgroundColor3 = Color3.fromRGB(50, 50, 50),
        BorderSizePixel = 0,
        Parent = self.Window
    })
    
    local sectionTitle = createInstance("TextLabel", {
        Size = UDim2.new(1, 0, 0, 25),
        BackgroundColor3 = Color3.fromRGB(0, 122, 204),
        TextColor3 = Color3.fromRGB(255, 255, 255),
        Text = title,
        TextScaled = true,
        BorderSizePixel = 0,
        Parent = section
    })
    
    local layout = createInstance("UIListLayout", {
        Padding = UDim.new(0, 10),
        HorizontalAlignment = Enum.HorizontalAlignment.Center,
        Parent = section
    })

    table.insert(self.Sections, section)
    return {
        CreateButton = function(self, text, onClick)
            local button = createInstance("TextButton", {
                Size = UDim2.new(1, -20, 0, 50),
                BackgroundColor3 = Color3.fromRGB(0, 122, 204),
                TextColor3 = Color3.fromRGB(255, 255, 255),
                Text = text,
                TextScaled = true,
                Parent = section
            })
            button.MouseButton1Click:Connect(onClick)
            return button
        end,
        
        CreateToggle = function(self, text, onToggle)
            local frame = createInstance("Frame", {
                Size = UDim2.new(1, -20, 0, 50),
                BackgroundColor3 = Color3.fromRGB(255, 255, 255),
                Parent = section
            })
            
            local label = createInstance("TextLabel", {
                Size = UDim2.new(0.5, 0, 1, 0),
                BackgroundColor3 = Color3.fromRGB(255, 255, 255),
                TextColor3 = Color3.fromRGB(0, 0, 0),
                Text = text,
                TextScaled = true,
                Parent = frame
            })

            local switch = createInstance("TextButton", {
                Size = UDim2.new(0.5, 0, 1, 0),
                Position = UDim2.new(0.5, 0, 0, 0),
                BackgroundColor3 = Color3.fromRGB(0, 122, 204),
                TextColor3 = Color3.fromRGB(255, 255, 255),
                Text = "OFF",
                TextScaled = true,
                Parent = frame
            })
            
            local toggled = false
            switch.MouseButton1Click:Connect(function()
                toggled = not toggled
                switch.BackgroundColor3 = toggled and Color3.fromRGB(0, 204, 122) or Color3.fromRGB(0, 122, 204)
                switch.Text = toggled and "ON" or "OFF"
                onToggle(toggled)
            end)
            
            return frame
        end
    }
end

return Library
